# V4.1 OpenClaw full-takeover
V4_WORK_ROOT="$HOME/Translation Task"
V4_KB_ROOT="$HOME/Knowledge Repository"
V4_PYTHON_BIN="<project_root>/.venv/bin/python"

# OpenClaw notification target
OPENCLAW_NOTIFY_TARGET=""
OPENCLAW_NOTIFY_CHANNEL="telegram"
OPENCLAW_NOTIFY_ACCOUNT="default"

# IMAP for email ingest (used by scripts/run_v4_email_poll.sh via .env.v4.local)
V4_IMAP_HOST=""
V4_IMAP_PORT=993
V4_IMAP_USER=""
V4_IMAP_PASSWORD=""
V4_IMAP_MAILBOX="INBOX"
V4_IMAP_FROM_FILTER="modeh@eventranz.com"
V4_IMAP_MAX_MESSAGES=5

# Translation pipeline defaults
OPENCLAW_STRICT_ROUTER=1
OPENCLAW_TRANSLATION_THINKING=high
OPENCLAW_AGENT_CALL_TIMEOUT_SECONDS=420
OPENCLAW_AGENT_CALL_MAX_ATTEMPTS=4
OPENCLAW_AGENT_CALL_RETRY_BACKOFF_SECONDS=4
OPENCLAW_AGENT_CALL_RETRY_MAX_BACKOFF_SECONDS=24
OPENCLAW_DIRECT_API_MAX_ATTEMPTS=4
OPENCLAW_DIRECT_API_BACKOFF_SECONDS=2.5
OPENCLAW_DIRECT_API_MAX_BACKOFF_SECONDS=20
OPENCLAW_COOLDOWN_FRIENDLY_MODE=1
OPENCLAW_COOLDOWN_RETRY_SECONDS=300
OPENCLAW_KIMI_CODING_MODEL=kimi-coding/k2p5
OPENCLAW_KIMI_CODING_BASE_URL=https://api.moonshot.cn/v1
OPENCLAW_INCLUDE_KIMI_FALLBACK=0
OPENCLAW_FALLBACK_CHAIN=deepseek-v3-2/DeepSeek,openai-codex/gpt-5.3-codex,google-antigravity/gemini-3-flash
OPENCLAW_PRIMARY_MODEL=zai/glm-5
OPENCLAW_FALLBACK_MODEL=deepseek-v3-2/DeepSeek
OPENCLAW_IMAGE_MODEL=openai-codex/gpt-5.2
OPENCLAW_CODEX_AGENT=translator-core
OPENCLAW_INTENT_AGENT=task-router
OPENCLAW_INTENT_CLASSIFIER_MODE=web
OPENCLAW_GEMINI_AGENT=review-core
OPENCLAW_GLM_ENABLED=1
OPENCLAW_GLM_GENERATOR_AGENT=glm-reviewer
OPENCLAW_GLM_MODEL=zai/glm-5

# Web gateway backend (strict mode: gateway failure => task failure, no direct API fallback)
OPENCLAW_WEB_GATEWAY_ENABLED=1
OPENCLAW_WEB_GATEWAY_STRICT=1
OPENCLAW_WEB_GATEWAY_BASE_URL=http://127.0.0.1:8765
OPENCLAW_WEB_GATEWAY_MODEL=chatgpt-web
OPENCLAW_WEB_GATEWAY_TIMEOUT_SECONDS=180
OPENCLAW_WEB_GATEWAY_REQUIRE_LOGIN=1
OPENCLAW_WEB_GATEWAY_TRACE=1
# When assistant selectors fail, the gateway falls back to extracting the tail of the page text.
# Increase this if large JSON responses get truncated (at the cost of larger trace payloads).
OPENCLAW_WEB_GATEWAY_MAIN_TAIL_CHARS=80000
# Optional: include the raw probe payload (selectors + captured texts) in web_calls traces.
OPENCLAW_WEB_GATEWAY_TRACE_PROBE_RAW=0
OPENCLAW_WEB_GATEWAY_PROFILES_DIR="$HOME/.openclaw/runtime/translation/web-profiles"
# macOS recommended: use real Chrome for better site compatibility (less bot-detection / better SSO).
OPENCLAW_WEB_GATEWAY_BROWSER_CHANNEL=chrome

# Web gateway session behavior
# - per_request: open/close a fresh page each call (more stable, more chats)
# - per_job: reuse one conversation per (provider, job_id) to keep a single thread per job
OPENCLAW_WEB_SESSION_MODE=per_job
OPENCLAW_WEB_SESSION_TTL_SECONDS=7200
OPENCLAW_WEB_SESSION_MAX_JOBS=6

# Web LLM providers (via web gateway)
OPENCLAW_WEB_LLM_PRIMARY=deepseek_web
OPENCLAW_WEB_LLM_FALLBACK=chatgpt_web
# Optional per-phase overrides (recommended: translate with ChatGPT, review with DeepSeek)
OPENCLAW_WEB_LLM_GENERATE_PRIMARY=chatgpt_web
OPENCLAW_WEB_LLM_GENERATE_FALLBACK=deepseek_web
OPENCLAW_WEB_LLM_REVIEW_PRIMARY=deepseek_web
OPENCLAW_WEB_LLM_REVIEW_FALLBACK=chatgpt_web
OPENCLAW_WEB_LLM_INTENT_PRIMARY=chatgpt_web
OPENCLAW_WEB_LLM_INTENT_FALLBACK=
# Strict gateway mode defaults: hard-disable direct API fallbacks.
OPENCLAW_GLM_DIRECT_FALLBACK_ENABLED=0
OPENCLAW_KIMI_CODING_DIRECT_FALLBACK_ENABLED=0
OPENCLAW_GLOSSARY_ENFORCER_ENABLED=1

# Format QA (OpenAI / Gemini / Kimi Vision)
OPENCLAW_VISION_BACKEND=kimi
OPENCLAW_GEMINI_VISION_MODEL=gemini-2.0-flash
OPENCLAW_MOONSHOT_VISION_MODEL=moonshot/kimi-k2.5
OPENCLAW_OPENAI_VISION_MODEL=openai-codex/gpt-5.2
OPENCLAW_FORMAT_QA_ENABLED=0
OPENCLAW_FORMAT_QA_THRESHOLD=0.85
OPENCLAW_FORMAT_QA_SHEETS_MAX=6
OPENCLAW_FORMAT_QA_MAX_RETRIES=2
OPENCLAW_DOCX_QA_ENABLED=0
OPENCLAW_DOCX_QA_PAGES_MAX=6
OPENCLAW_DOCX_QA_THRESHOLD=0.85
OPENCLAW_VISION_AESTHETICS_WARN_THRESHOLD=0.7
OPENCLAW_VISION_QA_IN_ROUND=1
OPENCLAW_VISION_QA_MAX_RETRIES=2
OPENCLAW_VISION_QA_TRIAL_MAX_RETRIES=0

# Preserve payload caps (to bound model JSON size)
OPENCLAW_XLSX_TRANSLATION_MAX_CELLS=2000
OPENCLAW_XLSX_MAX_CHARS_PER_CELL=400
# XLSX web-batch controls (used by web gateway providers)
OPENCLAW_XLSX_BATCH_MAX_CELLS=6
OPENCLAW_XLSX_BATCH_MAX_SOURCE_CHARS=8000
OPENCLAW_XLSX_BATCH_RETRY=1
# Auto-backfill missing cells after a batch (default 2 attempts per cell)
OPENCLAW_XLSX_BACKFILL_MAX_CELL_ATTEMPTS=2
OPENCLAW_AGENT_MESSAGE_MAX_BYTES=150000
OPENCLAW_PROVIDER_MESSAGE_LIMIT_BYTES=2097152
OPENCLAW_AGENT_MESSAGE_OVERHEAD_BYTES=1300000
# XLSX extraction scope controls (reduces preserve map size + avoids translating already-English templates)
# - If source_language is Arabic, arabic_only defaults to enabled in the orchestrator.
OPENCLAW_XLSX_ARABIC_ONLY=1
# - If an XLSX contains any sheet starting with "Interview_", only those sheets are extracted (default on for SPREADSHEET_TRANSLATION).
OPENCLAW_XLSX_FOCUS_INTERVIEW_SHEETS=1
# - Optional explicit sheet filters (regex). If INCLUDE is set, it overrides Interview focus.
OPENCLAW_XLSX_SHEET_INCLUDE_REGEX=
OPENCLAW_XLSX_SHEET_EXCLUDE_REGEX=
OPENCLAW_DOCX_TRANSLATION_MAX_UNITS=1200
OPENCLAW_DOCX_MAX_CHARS_PER_UNIT=800

# Hard output rules
OPENCLAW_DISALLOW_MARKDOWN=1

# Router/ingest attachment support
OPENCLAW_ROUTER_FILE_BLOCK_MAX_MB=35
OPENCLAW_ATTACHMENT_DOWNLOAD_MAX_MB=35
OPENCLAW_ATTACHMENT_DOWNLOAD_TIMEOUT_SECONDS=60

# Knowledge base + RAG
OPENCLAW_KB_ISOLATION_MODE=company_strict
OPENCLAW_RAG_BACKEND=clawrag
OPENCLAW_RAG_BASE_URL=http://127.0.0.1:8080
OPENCLAW_RAG_COLLECTION=translation-kb
OPENCLAW_RAG_COLLECTION_MODE=auto

# KB rerank (merge clawrag + local, then rerank)
OPENCLAW_KB_RERANK_FINAL_K=12
OPENCLAW_KB_RERANK_GLOSSARY_MIN=3
OPENCLAW_KB_RERANK_TERMINOLOGY_GLOSSARY_RATIO=0.4

# Runtime DB (recommended: local path; avoid cloud-synced folders)
OPENCLAW_STATE_DB_PATH=/Users/ivy/.openclaw/runtime/translation/state.sqlite

# Async run worker (recommended: enabled)
# - When enabled, `run` enqueues immediately and the worker executes jobs out-of-band.
# - `scripts/run_telegram_bot.sh` auto-starts the worker unless you disable it here.
OPENCLAW_RUN_WORKER_AUTOSTART=1
OPENCLAW_RUN_WORKER_POLL_SECONDS=2
OPENCLAW_RUN_WORKER_HEARTBEAT_SECONDS=30
OPENCLAW_RUN_WORKER_STUCK_SECONDS=21600
OPENCLAW_RUN_WORKER_MAX_ATTEMPTS=3
OPENCLAW_RUN_WORKER_CANCEL_POLL_SECONDS=0.5
OPENCLAW_RUN_WORKER_CANCEL_GRACE_SECONDS=5
