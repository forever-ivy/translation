# 2026-02-15

- Implemented hard output gates in `scripts/openclaw_translation_orchestrator.py`:
  - Markdown leakage detection (hard fail + auto-retry).
  - Format-preserve map coverage validation (DOCX/XLSX).
  - Optional in-round Vision QA trials that feed findings back into Codex retries (fidelity gate; aesthetics warning-only).
  - Quality report now records `pipeline_version`, gate policies, and per-round gate results.
- Fixed XLSX/Docx attachment ingest reliability:
  - `scripts/skill_message_router.py` now accepts URL attachments (`mediaUrl`) and extracts inline `<file ...>` blocks into a temp file path for ingest.
  - `scripts/skill_message_ingest.py` now downloads `mediaUrl` attachments with size/timeout limits and an extension allowlist.
- Added pipeline version stamping to `.system/execution_plan.json` and surfaced version in `scripts/skill_status_card.py`.
- Updated env template `config/env.example` with new toggles/limits.
- Updated/added unit tests; full suite passes (`73` tests).
- Fixed Telegram direct bot numeric reply bug: `scripts/telegram_bot.py` now lets `1` / `1) ...` pass to `handle_interaction_reply` (company selection) instead of being blocked by the “text too short” guard.
- Hardened post-run attachment handling to prevent mis-archiving new-task uploads as FINAL files:
  - `scripts/skill_message_ingest.py` now stages ambiguous attachments and prompts a numeric menu for destination (FINAL vs NEW vs discard).
  - New pending action `select_attachment_destination` implemented in `scripts/skill_approval.py` interaction replies.
- Strengthened attachment safety:
  - Fixed `Content-Length` fast-fail (no longer swallowed) and now returns `download_too_large`.
  - Added base64/local-path size limits + extension allowlist + invalid base64 protection.
- Improved `status` observability: pending action, final upload count, archived yes/no; clears expired pending actions.
- Fixed openpyxl deprecation in `scripts/xlsx_preserver.py` (replaced `align.copy(...)` usage).
- Added `docs/KB_AND_MEMORY_SYSTEM.md` plus new unit tests; full suite passes (`77` tests).
