# 2026-02-19

## Tauri + Pipeline Full-Stack Fixes (Verify/Logs/KBHealth/GLM/QA/Services)

### Tauri (Rust + Frontend)
- Verify paths fixed to use `Translated -EN/_VERIFY/<job_id>` and quality reads `.system/quality_report.json` (metrics 0..1 -> 0..100%).
- Verify UI now shows a quality panel even when unavailable/skipped, and avoids stale artifacts by clearing selection on job switch.
- Logs parsing fixed in store to match real log format (`YYYY-MM-DD HH:MM:SS [tag] LEVEL msg`), normalize `WARNING -> WARN`, and tolerate JSON lines.
- Settings save flow: save errors now keep "Unsaved changes"; Rust writer preserves quoted paths in `.env.v4.local`.
- Jobs milestones: ISO timestamps (`2026-...T...+00:00`) now render correctly.
- KBHealth is now real (no mock): pulls latest KB sync report + sqlite stats; supports "Sync Now".
- Services: per-row Start/Stop now controls single service (telegram/worker); preflight button debounced.

### Pipeline (Python)
- GLM: `OPENCLAW_GLM_ENABLED` now gates BOTH GLM generator in rounds and post-round GLM advisory review.
- GLM direct API fallback now reads key from `~/.openclaw/agents/main/agent/auth-profiles.json` when `GLM_API_KEY` env is missing (prefers `zai:default`, then `lastGood["zai"]`).
- QA resiliency: XLSX/DOCX vision QA now returns `status=skipped` when LibreOffice/soffice render fails or vision call unavailable; orchestrator treats DOCX skipped as non-fatal.
- Worker: reloads repo-root `.env.v4.local` before each job and passes a filtered env to the pipeline subprocess so toggles/keys take effect without restarting.

### Verification
- Python unit tests: `unittest discover` OK.
- Frontend: `npm run build` OK.
- Rust: `cargo build` OK.

## XLSX Partial-Translation Root Cause + Fix

- Diagnosed `job_telegram_20260219_052749_c13dd8e0`: each round produced a *different subset* of `xlsx_translation_map` by file:
  - Round 2 covered the 2 files that Round 3 omitted; Round 3 covered the other 4 files.
  - Orchestrator treated round outputs as full snapshots and overwrote the previous `xlsx_translation_map`, causing “half translated” outputs.
- Implemented robust merge semantics in `scripts/openclaw_translation_orchestrator.py`:
  - `_preserve_nonempty_translation_maps` now merges DOCX maps by unit id and XLSX maps by (file,sheet,cell), preferring newer entries.
  - Generators now merge incremental preserve maps forward across rounds when `current_draft` exists.
  - Hard-gate retry budget reset per-round (instead of being consumed entirely in round 1).
- Fixed convergence blockers:
  - Gemini reviewer “empty placeholder” reviews (pass=false, all metrics 0, no findings) are now treated as unavailable -> triggers `degraded_single_model`.
  - Vision QA `status=skipped` now yields warnings (not findings), so Vision 403/missing deps won't block a pass.
- Added tests:
  - Spreadsheet merge across rounds reaches `review_ready` with merged `xlsx_translation_map`.
  - Empty Gemini reviews degrade to single-model and still reach `review_ready`.
