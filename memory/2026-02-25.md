# 2026-02-25

## Tauri Frontend Slim Refactor (Runtime/Jobs/Verify/Logs/KB/Glossary/Settings)

- Routes/sidebar reduced to the core set (Runtime, Jobs, Verify, Logs, KB Health, Glossary, Settings).
- Deprecated pages removed: Dashboard/AlertCenter/Services/ApiConfig; legacy tab routing removed.
- Polling orchestrator/policies slimmed to only: start-openclaw (runtime), jobs, verify, logs.

Runtime (`StartOpenClaw.tsx`)
- Renamed UI copy to "Runtime".
- Added Preflight card (defaults to non-pass checks) with Run Preflight + Auto Fix.
- Added Gateway quick controls: Start Gateway / Stop Gateway.

Jobs (`Jobs.tsx`)
- Status filter expanded to real statuses (queued/preflight/needs_attention/...).
- Milestones now render recent real milestone events (no hardcoded fake milestone keys).

Verify (`Verify.tsx`, `jobStore.ts`)
- Verify now includes both `review_ready` and `needs_attention` sections.
- Removed "Coming soon" actions; replaced with executable actions:
  - Open _VERIFY folder
  - Open web_calls
  - Copy telegram commands: `ok <job_id>` and `no <job_id> needs_manual_revision`
- `refreshVerifyData` now fetches recent jobs and filters client-side.

Logs (`Logs.tsx`, `src-tauri/src/lib.rs`)
- Added `gateway` log selector in UI.
- Rust log reader supports `gateway` by reading `runtime_root/web_gateway.log`.
- "Common Issues" copy updated to match real workflow.

KB Health (`KBHealth.tsx`)
- Removed KB document browser/search/pagination.
- Reduced to health overview + Sync/Open root + top errors summary (+ hint to open kb_sync_latest.json).

Settings (`Settings.tsx`)
- Removed advanced env editor and secret-heavy model/API key forms.
- Kept only:
  - Core config (paths/routing/RAG) via save_config to `.env.v4.local`
  - Web Gateway env fields (read/write via getEnvSettings/saveEnvSettings)

Verification
- `npm -C tauri-app run typecheck` OK
- `npm -C tauri-app run build` OK
- `npm -C tauri-app test` OK
- `cd tauri-app/src-tauri && cargo check` OK

## Web LLM Provider Routing (Generate vs Review)

- Added per-phase Web Gateway provider overrides:
  - `OPENCLAW_WEB_LLM_GENERATE_PRIMARY/FALLBACK`
  - `OPENCLAW_WEB_LLM_REVIEW_PRIMARY/FALLBACK`
- Orchestrator now routes:
  - generation/translation via generate chain
  - verification/review via review chain
- Pipeline preflight now checks login readiness for the union of generate+review providers.
- Tauri Settings exposes the new env keys.

## Gateway Async Playwright + Runtime Minimal UI

- Fixed gateway login crash by refactoring `scripts/openclaw_web_gateway.py` to use `playwright.async_api` end-to-end (FastAPI routes now `async def`).
- Added per-provider `asyncio.Lock` serialization and TargetClosed self-heal (reset browser/context and retry once).
- Added lightweight API unit test that does not spawn a browser: `tests/test_openclaw_web_gateway_api.py` (calls route endpoints directly).
- Redid Runtime (`tauri-app/src/pages/StartOpenClaw.tsx`) to “Minimal + Details”:
  - Default shows only core actions + status strip + provider login list.
  - Guided steps / preflight / telegram diagnostics + gateway provider details moved into a collapsible Details card.
- Login error toast improved to short actionable summaries in `tauri-app/src/stores/serviceStore.ts`.

Verification
- `./.venv/bin/python -m unittest discover -s tests -p 'test_*.py'` OK
- `pnpm -C tauri-app run typecheck` OK
- `pnpm -C tauri-app test` OK
- `pnpm -C tauri-app run build` OK
- `cd tauri-app/src-tauri && cargo check` OK
